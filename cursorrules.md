# Cursor Rules - 全人类蛋白质组药物重定位项目规范

## 目录
- [1. 目录与路径验证](#1-目录与路径验证)
- [2. 数据管理与适配器开发](#2-数据管理与适配器开发)
- [3. 对接模块与综合评分体系](#3-对接模块与综合评分体系)
- [4. 流程控制与异常处理](#4-流程控制与异常处理)
- [5. 核心功能优先实现](#5-核心功能优先实现)
- [6. 代码规范与版本日志](#6-代码规范与版本日志)
- [7. 项目扩展与灵活性](#7-项目扩展与灵活性)
- [8. 开发环境与工具链](#8-开发环境与工具链)
- [9. 模块接口与数据格式契约](#9-模块接口与数据格式契约)
- [10. 版本日志](#10-版本日志)

---

## 1. 目录与路径验证
- **路径检查**：在进行任何操作前，务必使用 `list_dir` 检查当前工作目录是否正确。
- **明确归属**：禁止直接在根目录创建或修改文件，所有文件必须明确定义存放路径（例如：`frontend` 或 `backend`），以便团队协作和后续维护。

## 2. 数据管理与适配器开发
- **统一接口**：所有数据适配器必须实现 `fetch_data`、`parse_data` 及 `transform_data` 方法，确保接口标准化和统一调用。
- **真实数据要求**：当无法获取真实数据时，禁止使用示例数据作为回退，应主动报错、退出并提示详情。
- **日志记录**：每个适配器模块需详细记录数据获取和解析日志，便于追踪数据流和问题排查。

## 3. 对接模块与综合评分体系
- **对接策略**：
  - **快速对接**（fast_dock）：用于大规模初筛，提供粗略评分。
  - **深度对接**（deep_dock）：针对高可信候选，采用更精细计算。
  - **动力学模拟**（dynamics_simulation）：对关键候选进行分子动力学评估，验证结合稳定性。
- **综合评分**：
  - 当有实验基准数据时，采用加权组合Docking得分与实验得分（例如：权重可设置为0.6和0.4）来计算最终评分；
  - 无基准数据的情况下，直接采用Docking得分。
- **多维评价**：鼓励在评分中引入多维指标（例如：对接结果稳定性、结合位点匹配度、聚类一致性等），并可利用现有数据构建预测模型不断优化评分标准。

## 4. 流程控制与异常处理
- **检查点机制**：在长时任务中（如Colab运行），定期保存检查点及中间进度信息，确保遇到中断后能够恢复继续执行。
- **异常捕获**：捕获 `KeyboardInterrupt` 和其他常见异常时，及时记录日志，并提示用户是否保存进度、选择恢复或退出。
- **重试策略**：对于网络请求等易出问题操作，建议使用重试机制（例如使用 tenacity 库或 requests 的重试机制）保证执行稳定。

## 5. 核心功能优先实现
- **项目现阶段重点**：
  - 数据准备与质量控制
  - 实验基准构建与筛选数据管理
  - 对接计算及多维综合评分模块
- **扩展规划**：用户界面、数据可视化及动态反馈机制可在上述核心功能成熟后开发，保证先解决最关键的任务。

## 6. 代码规范与版本日志
- **代码注释**：每个模块和函数均需详细注释，说明参数、返回值和业务逻辑，便于团队理解与维护。
- **开发日志**：所有代码改动需记录在 `development_log.md` 中，包含修改日期、内容、测试结果及后续计划，形成完备的版本遁迹。

## 7. 项目扩展与灵活性
- **并行计算**：核心功能稳定后，考虑采用并行、分布式甚至GPU加速技术提升大规模对接计算效率。
- **模块扩展**：预留模块接口，便于未来扩展如动态反馈、可视化报表和用户交互系统，确保整体架构灵活可扩展。

## 8. 开发环境与工具链
- **Python版本**：建议使用 Python 3.8+。
- **依赖管理**：请通过 `requirements.txt` 安装项目依赖，确保环境统一：  
  `pip install -r requirements.txt`
- **版本控制**：采用 Git 管理代码，鼓励模块化开发并细分 commit 以便回溯。
- **持续集成**：建议接入 GitHub Actions 或其他 CI 工具，自动化测试和代码质量检查。
- **日志工具**：推荐使用 Python 内置的 logging 模块，并根据日志级别（DEBUG、INFO、WARNING、ERROR）详细记录系统运行状态。

## 9. 模块接口与数据格式契约
- **数据适配器**：输入和输出应严格按照标准数据格式实现，确保统一调用。
  - 例如：所有适配器返回的数据应为 Pandas DataFrame 或标准 JSON 格式。
- **Docking 模块**：输入格式示例：
  - 蛋白质信息：`{"uniprot_id": "P12345", "structure_file": "pdb_file.pdb"}`
  - 药物信息：`{"drug_id": "D001", "smiles": "CCC(=O)O"}`
  - 输出格式示例：`{"docking_score": 7.5, "mode": "deep", "details": "对接成功"}`  
- **评分模块**：应清楚标示各子指标及权重，接口文档需明确，便于后续模型替换或算法升级。

## 10. 版本日志
- **维护迭代**：记录每次文档和代码更新，包括修改时间、修改人员、主要改动内容、测试情况及后续计划。
- **示例**：
  - **2024-04-10**：初步制定核心功能与数据管理规则。
  - **2024-04-18**：增加开发环境与工具链说明，并补充异常处理及检查点机制细节。

---

以上规则旨在为全人类蛋白质组药物重定位项目提供一份详细、系统的开发、测试和上线操作指南，确保数据质量、流程稳定和模块可扩展性。请团队成员严格遵循并不断在项目迭代中更新完善！ 